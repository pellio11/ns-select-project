(function(t,u,b,d,m,h,a,l,n){b(u).ready(function(){function v(){var a=b(".time-row-8AM");b(".tribe-week-grid-wrapper").slimScroll({height:"500px",railVisible:!0,alwaysVisible:!0,start:a})}function z(){b(".tribe-event-placeholder").each(function(){var a=b(this).attr("data-event-id"),a=parseInt(b("#tribe-events-event-"+a).outerHeight());b(this).height(a)})}function A(a){a.each(function(){var a=b(this),f=a.next(),p={left:"0",width:"65%"},d={right:"0",width:"65%"};if(f.length){var e=f.offset(),h=[e.left,
e.left+f.outerWidth()],e=[e.top,e.top+f.outerHeight()],c=a.offset(),g=[c.left,c.left+a.outerWidth()],c=[c.top,c.top+a.outerHeight()];h[0]<g[1]&&(h[1]>g[0]&&e[0]<c[1]&&e[1]>c[0])&&(a.is(".overlap-right")?f.css(p).addClass("overlap-left"):(a.is(".overlap-left")||a.css(p),f.css(d).addClass("overlap-right")))}})}function B(){var a=b(".tribe-grid-body .tribe-grid-content-wrap .column > div[id*='tribe-events-event-']"),d=b(".tribe-week-grid-inner-wrap").height();a.each(function(){var a=b(this),f=a.attr("data-hour"),
c=a.attr("data-duration"),e=a.attr("data-min"),f=b('.tribe-week-grid-block[data-hour="'+f+'"]'),f=f.offset().top-f.parent().offset().top-f.parent().scrollTop(),f=parseInt(Math.round(f))+parseInt(e),e=parseInt(d)-parseInt(c)-parseInt(f);0>e&&(c=c+e-14);e={height:c-16+"px"};a.css({height:c+"px",top:f+"px"}).find("a").css(e).parent().css(e)});b("div[id^='tribe-events-event-']").css({visibility:"visible",opacity:"0"}).delay(500).animate({opacity:"1"},{duration:250});A(a);tribe_ev.fn.equal_height(b(".tribe-grid-header .tribe-grid-content-wrap .column"));
tribe_ev.fn.equal_height(b(".tribe-grid-allday .column"));setTimeout(function(){var a=b(".tribe-grid-body").height();b(".tribe-grid-body .tribe-grid-content-wrap .column").height(a)},250)}function C(a){var d=b('.tribe-mobile-day[data-day="'+a+'"]');a=b('.column[title="'+a+'"] .tribe-week-event');a.length&&a.each(function(){var a=b(this);a.tribe_has_attr("data-tribejson")&&(a=a.data("tribejson"),d.append(tribe_tmpl("tribe_tmpl_week_mobile",a)))})}function D(){var a=b(".tribe-events-mobile-day"),d=
b("#tribe-events-content > .tribe-events-grid");b("#tribe-mobile-container").length||b('<div id="tribe-mobile-container" />').insertAfter(d);a.each(function(){var a=b(this).attr("title"),f=b('.tribe-grid-content-wrap .column[title="'+a+'"]').find("span").attr("data-full-date"),d=b("#tribe-mobile-container"),e=b('.tribe-mobile-day[data-day="'+a+'"]');e.length?e.show():(d.append('<div class="tribe-mobile-day" data-day="'+a+'"></div>'),C(a));e.length||(e=b('.tribe-mobile-day[data-day="'+a+'"]'));!e.find("h5").length&&
e.find(".tribe-events-mobile").length&&e.prepend('<h5 class="tribe-mobile-day-date">'+f+"</h5>")})}function r(a,d){if(E.is(".tribe-mobile"))D();else{z();for(var c=b(".tribe-grid-allday"),p=c.find(".vevent"),h=parseInt(b(".tribe-grid-content-wrap .column").width())-8,e=1;8>e;e++)p.hasClass("tribe-dayspan"+e)&&c.find(".tribe-dayspan"+e).children("div").css("width",h*e+(4*(2*e-2)+(e-1))+"px");b(".tribe-grid-body .column:eq(5), .tribe-grid-body .column:eq(6), .tribe-grid-body .column:eq(7)").addClass("tribe-events-right");
B();a&&"function"===typeof a&&a()}}function w(f,c){if("change_view"!=tribe_events_bar_action&&(f.preventDefault(),!a.ajax_running)){var g=b("#tribe-bar-date");a.popping=!1;c?(a.date=c,d.cur_url=d.base_url+a.date+"/"):g.length&&""!==g.val()?(a.date="0"!==a.datepicker_format?tribeDateFormat(g.bootstrapDatepicker("getDate"),"tribeQuery"):g.val(),d.cur_url=d.base_url+a.date+"/"):x?d.cur_url=d.base_url+a.date+"/":(a.date=d.cur_date,d.cur_url=d.base_url+d.cur_date+"/");h.pre_ajax(function(){q()})}}function q(){b("#tribe-events-header");
b(".tribe-events-grid").tribe_spin();a.pushcount=0;a.ajax_running=!0;if(!a.popping&&(a.filter_cats&&(d.cur_url=d.base_url),a.params={action:"tribe_week",eventDate:a.date},a.url_params={},a.category&&(a.params.tribe_event_category=a.category),b(m).trigger("tribe_ev_serializeBar"),a.params=b.param(a.params),a.url_params=b.param(a.url_params),b(m).trigger("tribe_ev_collectParams"),a.pushstate=!0,a.do_string=!1,0<a.pushcount||a.filters))a.pushstate=!1,a.do_string=!0;l.pushstate?(n&&debug.time("Week View Ajax Timer"),
b(m).trigger("tribe_ev_ajaxStart").trigger("tribe_ev_weekView_AjaxStart"),b.post(TribeWeek.ajaxurl,a.params,function(f){a.initial_load=!1;h.enable_inputs("#tribe_events_filters_form","input, select");if(f.success){a.ajax_running=!1;d.ajax_response={total_count:"",view:f.view,max_pages:"",tribe_paged:"",timestamp:(new Date).getTime()};var c="",c=b.isFunction(b.fn.parseHTML)?b.parseHTML(f.html):f.html;b("#tribe-events-content.tribe-events-week-grid").replaceWith(c);r(v(),!1);b("div[id*='tribe-events-event-']").hide().fadeIn("fast");
a.page_title=b("#tribe-events-header").data("title");u.title=a.page_title;a.do_string&&history.pushState({tribe_url_params:a.url_params,tribe_params:a.params},a.page_title,d.cur_url+"?"+a.url_params);a.pushstate&&history.pushState({tribe_url_params:a.url_params,tribe_params:a.params},a.page_title,d.cur_url);b(m).trigger("tribe_ev_ajaxSuccess").trigger("tribe_ev_weekView_AjaxSuccess");n&&debug.timeEnd("Week View Ajax Timer")}})):t.location=a.url_params.length?d.cur_url+"?"+a.url_params:d.cur_url}var E=
b("body"),k=b("#tribe-bar-date"),F=b("#tribe-events"),c=b("#tribe-events-bar"),g=b("#tribe-events-header"),s=0,x=!1;Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var d=this.length>>>0,c=Number(b)||0,c=0>c?Math.ceil(c):Math.floor(c);for(0>c&&(c+=d);c<d;c++)if(c in this&&this[c]===a)return c;return-1});g.length&&(s=g.data("startofweek"));c.addClass("tribe-has-datepicker");c=g.data("date");"0"!==a.datepicker_format&&(c=tribeDateFormat(c,"tribeQuery"));a.date=c;c=[0,1,2,3,4,5,6];g=c.indexOf(s);
-1<g&&c.splice(g,1);g="yyyy-mm-dd";if("0"!==a.datepicker_format){var g=d.datepicker_formats.main[a.datepicker_format],y=h.get_url_param("tribe-bar-date");y&&k.val(tribeDateFormat(y,a.datepicker_format))}d.datepicker_opts={format:g,weekStart:s,daysOfWeekDisabled:c,autoclose:!0};k.bootstrapDatepicker(d.datepicker_opts).on("changeDate",function(b){if(!a.updating_picker){var c=tribeDateFormat(b.date,"tribeQuery");a.date=c;x=!0;if(l.no_bar()||l.live_ajax()&&l.pushstate)l.reset_on()||w(b,c)}});r(v(),!1);
b(m).on("tribe_ev_resizeComplete",function(){r(!1,!0)});l.pushstate&&!l.map_view()&&(k="action=tribe_week&eventDate="+a.date,d.params.length&&(k=k+"&"+d.params),a.category&&(k=k+"&tribe_event_category="+a.category),history.replaceState({tribe_params:k,tribe_url_params:d.params},"",location.href),b(t).on("popstate",function(b){if(b=b.originalEvent.state)a.do_string=!1,a.pushstate=!1,a.popping=!0,a.params=b.tribe_params,a.url_params=b.tribe_url_params,h.pre_ajax(function(){q()}),h.set_form(a.params)}));
F.on("click",".tribe-events-nav-previous, .tribe-events-nav-next",function(c){c.preventDefault();a.ajax_running||(c=b(this).find("a"),a.popping=!1,a.date=c.attr("data-week"),d.cur_url=c.attr("href"),"0"!==a.datepicker_format?h.update_picker(tribeDateFormat(a.date,d.datepicker_formats.main[a.datepicker_format])):h.update_picker(a.date),h.pre_ajax(function(){q()}))});b("form#tribe-bar-form").on("submit",function(a){w(a,null)});h.snap("#tribe-events-content","body","#tribe-events-footer .tribe-events-nav-previous, #tribe-events-footer .tribe-events-nav-next");
b(m).on("tribe_ev_runAjax",function(){q()});n&&debug.info("TEC Debug: tribe-events-week.js successfully loaded");a.view&&n&&debug.timeEnd("Tribe JS Init Timer")})})(window,document,jQuery,tribe_ev.data,tribe_ev.events,tribe_ev.fn,tribe_ev.state,tribe_ev.tests,tribe_debug);
